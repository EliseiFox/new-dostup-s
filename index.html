<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Chat</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #messages { margin-bottom: 10px; }
        #input { width: calc(100% - 100px); }
        #sendButton { width: 80px; }
        #connectButton { width: 120px; }
        textarea { width: 100%; height: 100px; }
    </style>
</head>
<body>
    <h1>P2P Chat</h1>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="Type a message...">
    <button id="sendButton">Send</button>
    <button id="connectButton">Connect</button>

    <h2>Offer SDP</h2>
    <textarea id="offerSdp" readonly></textarea>
    <button id="copyOffer">Copy Offer</button>

    <h2>Answer SDP</h2>
    <textarea id="answerSdp" readonly></textarea>
    <button id="copyAnswer">Copy Answer</button>

    <h2>ICE Candidate</h2>
    <textarea id="iceCandidate" readonly></textarea>
    <button id="copyIce">Copy ICE</button>

    <script>
        const messagesDiv = document.getElementById('messages');
        const input = document.getElementById('input');
        const sendButton = document.getElementById('sendButton');
        const connectButton = document.getElementById('connectButton');

        const offerSdpTextArea = document.getElementById('offerSdp');
        const answerSdpTextArea = document.getElementById('answerSdp');
        const iceCandidateTextArea = document.getElementById('iceCandidate');

        const copyOfferButton = document.getElementById('copyOffer');
        const copyAnswerButton = document.getElementById('copyAnswer');
        const copyIceButton = document.getElementById('copyIce');

        let peerConnection;
        let dataChannel;

        function logMessage(message) {
            messagesDiv.innerHTML += `<p>${message}</p>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function createConnection() {
            peerConnection = new RTCPeerConnection();
            dataChannel = peerConnection.createDataChannel('chat');

            dataChannel.onmessage = (event) => {
                logMessage('Peer: ' + event.data);
            };

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    iceCandidateTextArea.value = JSON.stringify(event.candidate);
                }
            };

            peerConnection.createOffer().then((offer) => {
                return peerConnection.setLocalDescription(offer);
            }).then(() => {
                offerSdpTextArea.value = peerConnection.localDescription.sdp;
            }).catch(console.error);
        }

        function handleOffer(offer) {
            peerConnection = new RTCPeerConnection();
            dataChannel = peerConnection.createDataChannel('chat');

            dataChannel.onmessage = (event) => {
                logMessage('Peer: ' + event.data);
            };

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    iceCandidateTextArea.value = JSON.stringify(event.candidate);
                }
            };

            peerConnection.setRemoteDescription(new RTCSessionDescription(offer)).then(() => {
                return peerConnection.createAnswer();
            }).then((answer) => {
                return peerConnection.setLocalDescription(answer);
            }).then(() => {
                answerSdpTextArea.value = peerConnection.localDescription.sdp;
            }).catch(console.error);
        }

        function handleAnswer(answer) {
            peerConnection.setRemoteDescription(new RTCSessionDescription(answer)).catch(console.error);
        }

        function handleIceCandidate(candidate) {
            peerConnection.addIceCandidate(new RTCIceCandidate(candidate)).catch(console.error);
        }

        function sendMessage() {
            const message = input.value;
            if (dataChannel && dataChannel.readyState === 'open') {
                dataChannel.send(message);
                logMessage('You: ' + message);
                input.value = '';
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }

        sendButton.addEventListener('click', sendMessage);

        connectButton.addEventListener('click', () => {
            const offer = prompt('Enter offer SDP:');
            if (offer) {
                handleOffer(offer);
            }

            const answer = prompt('Enter answer SDP:');
            if (answer) {
                handleAnswer(answer);
            }

            const iceCandidate = prompt('Enter ICE candidate:');
            if (iceCandidate) {
                handleIceCandidate(iceCandidate);
            }
        });

        copyOfferButton.addEventListener('click', () => {
            copyToClipboard(offerSdpTextArea.value);
        });

        copyAnswerButton.addEventListener('click', () => {
            copyToClipboard(answerSdpTextArea.value);
        });

        copyIceButton.addEventListener('click', () => {
            copyToClipboard(iceCandidateTextArea.value);
        });

    </script>
</body>
</html>
