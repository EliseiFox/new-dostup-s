<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple P2P Chat</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #messages { margin-bottom: 10px; }
        #input { width: calc(100% - 100px); }
        #sendButton { width: 80px; }
    </style>
</head>
<body>
    <h1>P2P Chat</h1>
    <div id="messages"></div>
    <input type="text" id="input" placeholder="Type a message...">
    <button id="sendButton">Send</button>
    <button id="connectButton">Connect</button>
    <script>
        const messagesDiv = document.getElementById('messages');
        const input = document.getElementById('input');
        const sendButton = document.getElementById('sendButton');
        const connectButton = document.getElementById('connectButton');

        let peerConnection;
        let dataChannel;

        function logMessage(message) {
            messagesDiv.innerHTML += `<p>${message}</p>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function createConnection() {
            peerConnection = new RTCPeerConnection();
            dataChannel = peerConnection.createDataChannel('chat');

            dataChannel.onmessage = (event) => {
                logMessage('Peer: ' + event.data);
            };

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    // Send the candidate to the remote peer
                    // In a real application, you would send this via a signaling server or other means
                    console.log('ICE Candidate:', event.candidate);
                }
            };

            peerConnection.createOffer().then((offer) => {
                return peerConnection.setLocalDescription(offer);
            }).then(() => {
                // Display the offer in the console or a UI for the other peer to copy
                console.log('Offer:', peerConnection.localDescription.sdp);
                logMessage('Offer: ' + peerConnection.localDescription.sdp);
            }).catch(console.error);
        }

        function handleOffer(offer) {
            peerConnection = new RTCPeerConnection();
            dataChannel = peerConnection.createDataChannel('chat');

            dataChannel.onmessage = (event) => {
                logMessage('Peer: ' + event.data);
            };

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    // Send the candidate to the remote peer
                    console.log('ICE Candidate:', event.candidate);
                }
            };

            peerConnection.setRemoteDescription(new RTCSessionDescription(offer)).then(() => {
                return peerConnection.createAnswer();
            }).then((answer) => {
                return peerConnection.setLocalDescription(answer);
            }).then(() => {
                // Display the answer in the console or a UI for the other peer to copy
                console.log('Answer:', peerConnection.localDescription.sdp);
                logMessage('Answer: ' + peerConnection.localDescription.sdp);
            }).catch(console.error);
        }

        function handleAnswer(answer) {
            peerConnection.setRemoteDescription(new RTCSessionDescription(answer)).catch(console.error);
        }

        function handleIceCandidate(candidate) {
            peerConnection.addIceCandidate(new RTCIceCandidate(candidate)).catch(console.error);
        }

        function sendMessage() {
            const message = input.value;
            if (dataChannel && dataChannel.readyState === 'open') {
                dataChannel.send(message);
                logMessage('You: ' + message);
                input.value = '';
            }
        }

        sendButton.addEventListener('click', sendMessage);

        connectButton.addEventListener('click', () => {
            const offer = prompt('Enter offer SDP:');
            if (offer) {
                handleOffer(offer);
            }

            const answer = prompt('Enter answer SDP:');
            if (answer) {
                handleAnswer(answer);
            }

            const iceCandidate = prompt('Enter ICE candidate:');
            if (iceCandidate) {
                handleIceCandidate(iceCandidate);
            }
        });

        // For a real application, implement a proper signaling mechanism to exchange offers, answers, and ICE candidates
    </script>
</body>
</html>
